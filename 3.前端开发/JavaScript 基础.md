### 原理

#### 语言特性

- **高级语言**：不需要手动管理内存等资源
- **垃圾回收**：从内存中自动删除旧的、未使用的对象
- **即时编译语言**：解析->编译->执行。首先生成未优化的机器代码立即执行，在执行过程中后台对代码进行优化并重新编译执行。
- **多范式**：过程式编程，面向对象编程，函数式编程
- **基于原型、面向对象**：JavaScript 对象有一个指向一个原型对象的链。当试图访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。
- **头等函数**：函数可以被当作参数传递给其他函数，可以作为另一个函数的返回值，还可以被赋值给一个变量
- **动态类型/弱类型**：没有类型定义，类型在运行时确认，类型可以动态改变
- **单线程**：逐步执行，一次只做一件事
- **非阻塞/事件循环**：JavaScript在执行代码时，会将同步的代码按照顺序排在执行栈中，然后依次执行里面的函数。当遇到异步任务时，就将其放入任务队列中，等待当前执行栈所有同步代码执行完成之后，就会从异步任务队列中取出已完成的异步任务的回调并将其放入执行栈中继续执行，如此循环往复，直到执行完所有任务。

#### 执行上下文

每当 Javascript 代码在运行的时候，它都是在执行上下文中运行，执行上下文包含了执行代码需要的东西，包括变量环境，作用域链，this关键字。

- **全局执行上下文** — 这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事：创建一个全局的 window 对象（浏览器的情况下），并且设置 `this` 的值等于这个全局对象。一个程序中只会有一个全局执行上下文。
- **函数执行上下文** — 每当一个函数被调用时, 都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序（将在后文讨论）执行一系列步骤。

#### JavaScript执行过程

1. 创建全局执行上下文
2. 执行顶层代码
3. 对于每个函数调用，创建对应的函数执行上下文并执行，等待回调

#### 运行时

![[Pasted image 20231130150545.png]]

- 堆：存储对象。
- 执行栈：存储函数调用（执行上下文）的栈结构，遵循**先进后出**的原则。**它主要负责跟踪所有要执行的代码。**
- 任务队列：保存异步任务，遵循**先进先出**的原则。**它主要负责将新的任务发送到队列中进行处理。**

JavaScript在执行代码时，会将同步的代码按照顺序排在执行栈中，然后依次执行里面的函数。当遇到异步任务时，就将其放入任务队列中，等待当前执行栈所有同步代码执行完成之后，就会从异步任务队列中取出已完成的异步任务的回调并将其放入执行栈中继续执行，如此循环往复，直到执行完所有任务。

#### 作用域

- 全局作用域：定义在全局作用域的变量可以在任何地方访问
- 函数作用域：定义在函数作用域的变量只能在函数内部访问（在严格模式中，函数作用域也是块作用域）
- 块作用域：使用`let`和`const`关键字在块作用域中定义的变量只能在块作用域中访问
- 作用域链：内部作用域可以访问外部作用域中块作用域以外的变量。

#### this 关键字

`this` 的值取决于它出现的上下文：函数、类或全局。
##### 函数上下文

- 作为对象的方法被调用时，指向被调访问的对象；
- 简单的调用函数，this的值为undefined
- 箭头函数中，不会创建一个新的 `this` 绑定，保留了闭合词法上下文的 `this` 值。无论如何调用，`this` 都绑定到函数创建时的值。
- 在事件监听函数中，指向回


#### 变量提升

变量提升是指在 JavaScript 代码执行过程中，JavaScript 引擎把变量的声明部分和函数的声明部分提升到代码开头的行为。`var`声明的变量被提升后，会给变量设置默认值为 undefined。

如果区块中存在 let 和 const，这个区块对这两个关键字声明的变量，从一开始就形成了封闭作用域。假如尝试在声明前去使用这类变量，就会报错。这一段会报错的区域就是**暂时性死区**。

在编译阶段，JS 引擎会搜集所有的变量声明，并且提前让声明生效。

### 语法
#### 变量名规范

- 只能包含数字、字母、下划线和美元符号$
- 首字母不能是数字
- 不能是关键字和保留字
- 普通变量名采用驼峰命名法，常量使用大写

```js
let firstName = 'Rick';
const PI = 3.14
```

#### 数据类型

- 包括基本数据类型和引用类型
- 七种基本数据类型：Number、String、Boolean、Undefined、Null、Symbol、BigInt
- 在比较两个操作数时，双等号（`==`）将执行类型转换，并且会按照 IEEE 754 标准对 `NaN`、`-0` 和 `+0` 进行特殊处理（故 `NaN != NaN`，且 `-0 == +0`）；
- 三等号（`===`）做的比较与双等号相同（包括对 `NaN`、`-0` 和 `+0` 的特殊处理）但不进行类型转换；如果类型不同，则返回 `false`；

```js
// BigInt 可以表示表示任意大小的整数
const x = BigInt(Number.MAX_SAFE_INTEGER); // 9007199254740991n
x + 1n === x + 2n; // false，因为 9007199254740992n 和 9007199254740993n 不相等
```

| x                   | y                   | `==`       | `===`      | `Object.is` | `SameValueZero` |
| ------------------- | ------------------- | ---------- | ---------- | ----------- | --------------- |
| `undefined`         | `undefined`         | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `null`              | `null`              | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `true`              | `true`              | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `false`             | `false`             | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `'foo'`             | `'foo'`             | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `0`                 | `0`                 | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `+0`                | `-0`                | `✅ true`  | `✅ true`  | `❌ false`  | `✅ true`       |
| `+0`                | `0`                 | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `-0`                | `0`                 | `✅ true`  | `✅ true`  | `❌ false`  | `✅ true`       |
| `0n`                | `-0n`               | `✅ true`  | `✅ true`  | `✅ true`   | `✅ true`       |
| `0`                 | `false`             | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `""`                | `false`             | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `""`                | `0`                 | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `'0'`               | `0`                 | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `'17'`              | `17`                | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `[1, 2]`            | `'1,2'`             | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `new String('foo')` | `'foo'`             | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `null`              | `undefined`         | `✅ true`  | `❌ false` | `❌ false`  | `❌ false`      |
| `null`              | `false`             | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `undefined`         | `false`             | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `{ foo: 'bar' }`    | `{ foo: 'bar' }`    | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `new String('foo')` | `new String('foo')` | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `0`                 | `null`              | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `0`                 | `NaN`               | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `'foo'`             | `NaN`               | `❌ false` | `❌ false` | `❌ false`  | `❌ false`      |
| `NaN`               | `NaN`               | `❌ false` | `❌ false` | `✅ true`   | `✅ true`       |
#### 声明

- `var` 声明一个变量，可选初始化一个值。
- `let` 声明一个块作用域的局部变量，可选初始化一个值。
- `const` 声明一个块作用域的只读常量。
- `let` 和 `const` **会被提升**变量到代码块的顶部但是不会被赋予初始值。在变量声明之前引用这个变量，将抛出引用错误（ReferenceError）。这个变量将从代码块一开始的时候就处在一个“暂时性死区”，直到这个变量被声明为止。
- 对于函数来说，只有**函数声明**会被提升到顶部，而**函数表达式**不会被提升。

#### 运算符

```js
// 指数运算
2 ** 3 // 2 * 2 * 2

x = y = 20 - 10 // x = 10, y = 10
```

| Operator type          | Individual operators                      |
| ---------------------- | ----------------------------------------- |
| member                 | `. []`                                    |
| call / create instance | `() new`                                  |
| negation/increment     | `! ~ - + ++ -- typeof void delete`        |
| multiply/divide        | `* / %`                                   |
| addition/subtraction   | `+ -`                                     |
| bitwise shift          | `<< >> >>>`                               |
| relational             | `< <= > >= in instanceof`                 |
| equality               | `== != === !==`                           |
| bitwise-and            | `&`                                       |
| bitwise-xor            | `^`                                       |
| bitwise-or             | `\|`                                      |
| logical-and            | `&&`                                      |
| logical-or             | `\|`                                      |
| conditional            | `?:`                                      |
| assignment             | `= += -= *= /= %= <<= >>= >>>= &= ^= \|=` |
| comma                  | `,`                                       |
#### 假值

**假值**（**falsy**，有时写为 **falsey**）是在 Boolean上下文中认定为 false 的值。

JavaScript在需要用到布尔类型值的上下文中使用强制类型转换将值转换为布尔值，例如条件语句。

5个假值：0，''，undefined，null，NaN

#### 函数

```js
// 函数声明
function calc() {
 return true;
}

// 函数表达式/匿名函数
// 无法在声明之前调用
const calc = function () {
	return true
}

// 箭头函数
const calc = test => true
```